<!DOCTYPE HTML>
<html>

	<head>
		<title>Chat Bubbles</title>
		
    
    <link rel="stylesheet" href="/static/bootstrap.css">
    <link rel="stylesheet" href="/static/chat.css">
    
		<script type='text/javascript' src="/static/jquery-3.6.3.min.js"></script>
    <script type='text/javascript' src='/static/bootstrap.bundle.min.js'></script>
    <script type='text/javascript' src='/static/websocket.js'></script>
    <script type='text/javascript' src='/static/audio.js'></script>
    
		<script type="text/javascript">
			$(function(){
				$("#submit_left").click(function() {
					var left_text = $('textarea#input_text_left').val(); // get textarea contents
					if ($('textarea#input_text_left').val() != '') { // make sure textarea is not empty
						$('#container').append('<br/><div class="message_body">'
								+ left_text +
								'</div><br/>');
						$("#input_text_left").val('');
					}
				});
			});
			
      function muteAudioInput() {  
        var button = document.getElementById('mute-audio-input');
        var toggled = button.classList.contains('active');
        console.log(`muteAudioInput(${toggled})`);
        button.innerHTML = toggled ? "Unmute Mic" : "Mute Mic";
        if( audioInputTrack != undefined )
          audioInputTrack.enabled = !toggled;
      }
      
      let sampleCount = 0;
      
      function generateAudio() {
        
        samples = new Int16Array(4800);
        const hz = 440.0;
        let time = Date.now() / 1000.0;
        
        for (i = 0; i < samples.length; i++) {
          samples[i] = Math.sin(sampleCount * (Math.sin(sampleCount/24000.0)+hz) * Math.PI * 2.0 / 48000.0) * 32767;
          sampleCount++;
        }
        onAudioOutput(samples);
      }
      
      window.onload = function() {
      
        connectWebsocket();
        enumerateAudioDevices();
        openAudioDevices();
        
        window.setInterval(function() {
            var bubbleContainer = document.getElementById('container');
            bubbleContainer.scrollTop = bubbleContainer.scrollHeight;
        }, 100);
      
        //window.setInterval(generateAudio, 100);
      }
		</script>
		
    
	</head>
	
	<body>
		<h2>llamaspeak</h2>
		
		<div id="container">
			<!--<h3>Conversation</h3>-->
		</div>
		
    <div id="chat_left">
			<textarea id="input_text_left"></textarea>
			<br/>
			<button id="submit_left">Submit</button>
		</div>
    
    <div>
      <label for="audio-input-select">Mic:</label>
      <select id="audio-input-select" name="audio-input-select" onclick="openAudioDevices()"></select>
    </div>
		
    <div>
      <label for="audio-output-select">Speaker:</label>
      <select id="audio-output-select" name="audio-output-select" onclick="openAudioDevices()"></select>
    </div>

    <button type="button" id="mute-audio-input" class="btn btn-primary" data-bs-toggle="button" autocomplete="off" onclick="muteAudioInput()">Mute Mic</button>

	</body>
</html>